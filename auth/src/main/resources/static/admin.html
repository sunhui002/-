<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>layout 管理系统大布局 - Layui</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo layui-hide-xs layui-bg-black">首页</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>

            <li class="layui-nav-item layui-hide-xs"><a href="">nav 1</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">nav 2</a></li>
            <li class="layui-nav-item layui-hide-xs"><a href="">nav 3</a></li>
            <li class="layui-nav-item">
                <a href="javascript:;">nav groups</a>
                <dl class="layui-nav-child">
                    <dd><a href="">menu 11</a></dd>
                    <dd><a href="">menu 22</a></dd>
                    <dd><a href="">menu 33</a></dd>
                </dl>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;">
                    <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" class="layui-nav-img">
                    tester
                </a>
                <dl class="layui-nav-child">
                    <dd><a href="">Your Profile</a></dd>
                    <dd><a href="">Settings</a></dd>
                    <dd><a href="">Sign out</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
        </ul>
    </div>

    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" lay-filter="test" id="memus"></ul>

            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
<!--            <ul class="layui-nav layui-nav-tree" lay-filter="test">-->
<!--                <li class="layui-nav-item layui-nav-itemed">-->
<!--                    <a class="" href="javascript:;">menu group 1</a>-->
<!--                    <dl class="layui-nav-child">-->
<!--                        <dd><a href="javascript:;">menu 1</a></dd>-->
<!--                        <dd><a href="javascript:;">menu 2</a></dd>-->
<!--                        <dd><a href="javascript:;">menu 3</a></dd>-->
<!--                        <dd><a href="">the links</a></dd>-->
<!--                    </dl>-->
<!--                </li>-->
<!--                <li class="layui-nav-item">-->
<!--                    <a href="javascript:;">menu group 2</a>-->
<!--                    <dl class="layui-nav-child">-->
<!--                        <dd><a href="javascript:;">list 1</a></dd>-->
<!--                        <dd><a href="javascript:;">list 2</a></dd>-->
<!--                        <dd><a href="">超链接</a></dd>-->
<!--                    </dl>-->
<!--                </li>-->
<!--                <li class="layui-nav-item"><a href="javascript:;">click menu item</a></li>-->
<!--                <li class="layui-nav-item"><a href="">the links</a></li>-->
<!--            </ul>-->
        </div>
    </div>
    <div class="layui-body">
        <!-- 内容主体区域 -->
        <div class="layui-tab" lay-allowclose="true" lay-filter="tabs">
            <ul class="layui-tab-title">
                <li class="first-tab layui-this">主页</li>
            </ul>
            <div class="layui-tab-content">
                <div class="layui-tab-item layui-show"  >
<!--                    <iframe th:src="@{/login.html}" frameborder="0" name="content" width="100%" id="home"></iframe>
-->
                    <iframe data-frameid="324"  frameborder="0" src="index.html" style="width:100%;height:99%;"></iframe>
                </div>
            </div>
        </div>
    </div>
<!--    <div class="layui-body">-->
<!--        &lt;!&ndash; 内容主体区域 &ndash;&gt;-->
<!--        <div style="padding: 15px;">-->
<!--            <div class="layui-tab app-container" lay-allowClose="true" lay-filter="tabs">-->
<!--                <ul id="appTabs" class="layui-tab-title custom-tab"></ul>-->
<!--            <div id="appTabPage" class="layui-tab-content"></div>-->
<!--        </div>-->

<!--        </div>-->
<!--    </div>-->

    <div class="layui-footer">
        <!-- 底部固定区域 -->
        底部固定区域
    </div>
</div>
</body>
<script src="layui/layui.js"></script>
<script src="layui/core.util.js"></script>
<!--<script type="text/javascript" src="./layui/jquery-2.0.3.min.js"></script>-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    //注意：导航 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function () {
        var $ = layui.jquery;
        // var layer = layui.layer;
        // var form = layui.form;
        var element = layui.element;
        //定义ids数组，用来记录已经打开的tab选项卡
        var ids = [];
        FrameWH();
        // element.on('nav(demo)', function () {
        //     var id = $(this).attr("data-id");
        //     var title = $(this).attr("data-title");
        //     var url = $(this).attr("data-url");
        //     // console.log(id);
        //     // console.log(title);
        //     //判断是否为以及菜单，如果不是一级菜单则创建tab
        //     if (typeof(id) != "undefined") {
        //         //判断选项卡是否已经被打开 下标为-1则未打开
        //         if (ids.indexOf(id) == -1) {
        //             element.tabAdd('tabs', {
        //                 title: title
        //                 // ,content: '<iframe src="/console.html" scrolling="auto" frameborder="0"></iframe>'
        //                 , content: createIframe(url)
        //                 , id: id
        //             });
        //             ids.push(id);
        //             //console.log(ids.indexOf(id));
        //         }
        //         //已经打开的tab直接切换
        //         element.tabChange('tabs', id);
        //         //删除tab时，从ids中将该tab的id删除，如果不删除会打不开该tab
        //         element.on('tabDelete(tabs)', function (elem) {
        //             var index = elem.index;
        //             ids.splice(index, 1);
        //         });
        //     }
        //
        //     //创建iframe
        //     function createIframe(url) {
        //         return '<iframe src="' + url + '" scrolling="auto" frameborder="0" ></iframe>'
        //     }
        // });
        var token=localStorage.getItem("token");
        //获取所有的菜单
        $.ajax({
            type: "GET",
            url: "http://127.0.0.1:8081/api/account/getClientData",
            dataType: "json",
            data:{token : token},
            success: function (data) {
                //先添加所有的主材单
                $.each(data.KeyValue, function (i, obj) {
                    var content = '<li class="layui-nav-item">';
                    content += '<a href="javascript:;">' + obj.Caption + "</a>";
                    //这里是添加所有的子菜单
                    content += loadchild(obj);
                    content += "</li>";
                    $(".layui-nav-tree").append(content);
                });
                element.init();
            },
            error: function (jqXHR) {
                // aler("发生错误：" + jqXHR.status);
            }
        });

        //组装子菜单的方法
        function loadchild(obj) {
            if (obj == null) {
                return;
            }

            var content = "";
            if (obj.SubNodes != null && obj.SubNodes.length > 0) {
                content += '<dl class="layui-nav-child">';
            } else {
                content += '<dl>';
            }

            if (obj.SubNodes != null && obj.SubNodes.length > 0) {
                $.each(obj.SubNodes, function (i, note) {
                    //console.log(note.title);
                    content += '<dd>';
                    content += "<a href=\"javascript:;\" data-id=\"" + note.Menuguid + "\" data-title=\"" + note.Caption + "\" class=\"" + "subMenu" + "\" data-url=\"" + note.RunUrl + "\">" + note.Caption + "</a>";
                    //subStr += "<a href=\"javascript:;\" data-src=\"" + note.url + "\" data-menuid=\"" + subMenu.menuId + "\" data-title=\"" + subMenu.name + "\">" + subMenu.name + "</a>";
                    if (note.SubNodes == null) {
                        return;
                    }
                    content += loadchild(note);
                    content += '</dd>';
                });
                content += '</dl>';
            }
            console.log(content);
            return content;
        }
        $(document).on('click','.subMenu',function () {
            var dataid = $(this);
            if ($(".layui-tab-title li[lay-id]").length <= 0) {
                active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
            } else {
                var isData = false;
                $.each($(".layui-tab-title li[lay-id]"), function () {
                    if ($(this).attr("lay-id") == dataid.attr("data-id")) {
                        isData = true;
                    }
                })
                if (isData == false) {
                    active.tabAdd(dataid.attr("data-url"), dataid.attr("data-id"), dataid.attr("data-title"));
                }
            }
            active.tabChange(dataid.attr("data-id"));
        });
            var active = {
                //在这里给active绑定几项事件，后面可通过active调用这些事件
                tabAdd: function (url, id, name) {
                    //新增一个Tab项 传入三个参数，分别对应其标题，tab页面的地址，还有一个规定的id，是标签中data-id的属性值
                    //关于tabAdd的方法所传入的参数可看layui的开发文档中基础方法部分
                    //tabs:中间主体的fiter名
                    element.tabAdd('tabs', {
                        title: name,
                        content: '<iframe data-frameid="' + id + '" scrolling="auto" frameborder="0" src="' + url +
                            '" style="width:100%;height:99%;"></iframe>',
                        id: id //规定好的id
                    })
                    FrameWH(); //计算ifram层的大小
                },
                tabChange: function (id) {
                    //切换到指定Tab项
                    element.tabChange('tabs', id); //根据传入的id传入到指定的tab项
                },
                tabDelete: function (id) {
                    element.tabDelete("tabs", id); //删除
                }
            };

            function FrameWH() {
                var h = $(window).height();
                $("iframe").css("height", h + "px");
            }



    });
</script>

</html>
